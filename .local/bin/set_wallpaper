#!/usr/bin/env bash

set -o errexit
set -o pipefail

WALLPAPERS_PATH="$HOME/.local/share/wallpapers"
WALLPAPER_DEST="$HOME/.local/share/bg"

PROMPT_PROGRAM="dmenu -i -l 10 -p \"Choose wallpaper\""
if [[ -t 1 ]]; then
	PROMPT_PROGRAM="gum filter --header \"Choose wallpaper\""
fi

choice="$(find "$WALLPAPERS_PATH" -maxdepth 1 \
	-name '*.png' -o \
	-name '*.jpg' -o \
	-name '*.jpeg' | sort | sed -E 's/.*\/([^\/]+)$/\1/' |
	eval "$PROMPT_PROGRAM")"

cp "$WALLPAPERS_PATH/$choice" "$WALLPAPER_DEST"

if command -v hyprpaper &>/dev/null; then
	pkill hyprpaper
	nohup hyprpaper &>/dev/null &
fi
